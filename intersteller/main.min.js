var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),world;!function(e){var t=function(e){function t(t){void 0===t&&(t=null);var i=e.call(this,t)||this;return i.selfTime=0,i.speedx=0,i.speedy=0,i.size=0,i.type=p2.Body.DYNAMIC,i}return __extends(t,e),t.prototype.dispose=function(){},t.prototype.render=function(){this.selfTime++},Object.defineProperty(t.prototype,"x",{get:function(){return this.position[0]/t.factor},set:function(e){this.position[0]=e*t.factor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position[1]/t.factor},set:function(e){this.position[1]=e*t.factor},enumerable:!0,configurable:!0}),t.factor=50,t.BORDER=Math.pow(2,0),t.PLAYER=Math.pow(2,1),t.ENEMY=Math.pow(2,2),t.P_BULLET=Math.pow(2,3),t.E_BULLET=Math.pow(2,4),t.POWERUPS=Math.pow(2,5),t.VIEWPORT=Math.pow(2,6),t}(p2.Body);e.FlyingObject=t,__reflect(t.prototype,"world.FlyingObject")}(world||(world={}));var game;!function(e){var t=function(e){function t(t){return void 0===t&&(t=null),e.call(this,t)||this}return __extends(t,e),t.prototype.getHit=function(e){},t}(world.FlyingObject);e.Ship=t,__reflect(t.prototype,"game.Ship")}(game||(game={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){var e=this;Global.stage=this.stage,Global.world=new p2.World,Global.shipControl=new ui.ShipController,Global.gameView=new game.GameView,Global.playerShip=new game.PlayerShip({mass:1}),Global.gameView.addFob(Global.playerShip),Global.world.addBody(Global.playerShip),Global.playerShip.x=.5*Global.gameView.worldWidth,Global.playerShip.y=.5*Global.gameView.worldHeight,this.addChild(Global.gameView),this.addChild(Global.shipControl),Global.world.gravity=[0,0];for(var t=0;12>t;t++){var i=new game.EnemyShip({mass:1});Global.world.addBody(i),i.x=Global.playerShip.x-200+80*t,i.y=Global.playerShip.y-200,i.behavior.push(game.EnemyShip.LOOKAT),i.behavior.push(game.EnemyShip.FOLLOW),i.behavior.push(game.EnemyShip.ORBIT),i.orbitRadius=200+300*Math.random(),i.size=50,Global.gameView.addFob(i)}var o=0;for(var a in game.PowerUps.TYPES){var r=new game.PowerUps({mass:.01},a,20);Global.gameView.addFob(r),Global.world.addBody(r),r.x=.6*Global.gameView.worldWidth+100*o,r.y=.6*Global.gameView.worldHeight,r.damping=0,r.velocity=[10*Math.random()-5,10*Math.random()-5],o++}egret.startTick(this.globalTick,this),Global.world.on("impact",function(){e.impact(Global.world.impactEvent)},null),Global.world.on("endContact",function(){e.stopContact(Global.world.endContactEvent)},null),Global.world.on("beginContact",function(){e.startContact(Global.world.beginContactEvent)},null),Global.stage.addEventListener(egret.Event.RESIZE,this.resizeH,this)},t.prototype.resizeH=function(){Global.shipControl.width=Global.stage.stageWidth,Global.shipControl.height=Global.stage.stageHeight},t.prototype.globalTick=function(e){Global.shipControl.isMoveDown?(Global.playerShip.speedx=Math.cos(Global.shipControl.moveRad)*Global.playerShip.speedMax,Global.playerShip.speedy=Math.sin(Global.shipControl.moveRad)*Global.playerShip.speedMax,Global.playerShip.x+=Global.playerShip.speedx,Global.playerShip.y+=Global.playerShip.speedy,Global.playerShip.angle=Global.shipControl.moveRad):(Global.playerShip.speedx*=.9,Global.playerShip.speedy*=.9,Global.playerShip.x+=Global.playerShip.speedx,Global.playerShip.y+=Global.playerShip.speedy),Global.shipControl.isFireDown?(Global.playerShip.angle=Global.shipControl.fireRad,Global.playerShip.fire(),Global.playerShip.generateBullet()):Global.playerShip.stopFire(),Global.shipControl.isShieldDown?Global.playerShip.openShield():Global.playerShip.closeShield();for(var t=0;t<Global.world.bodies.length;t++)Global.world.bodies[t]instanceof world.FlyingObject&&Global.world.bodies[t].render(),this.renderBody(Global.world.bodies[t]);return Global.world.step(1e3/60),Global.gameView.render(),Global.shipControl.buffBar.render(),!0},t.prototype.renderBody=function(e){for(var t=0;t<e.displays.length;t++)e.displays[t].x=e.position[0]/world.FlyingObject.factor,e.displays[t].y=e.position[1]/world.FlyingObject.factor,0==t&&(e.displays[t].rotation=180*e.angle/Math.PI)},t.prototype.startContact=function(e){var t=Global.world.beginContactEvent.shapeA,i=Global.world.beginContactEvent.shapeB,o=Global.world.beginContactEvent.bodyA,a=Global.world.beginContactEvent.bodyB;switch(t.collisionGroup|i.collisionGroup){case world.FlyingObject.PLAYER|world.FlyingObject.ENEMY:console.log("death");break;case world.FlyingObject.VIEWPORT|world.FlyingObject.POWERUPS:t.collisionGroup==world.FlyingObject.POWERUPS?o.outOfView=!1:a.outOfView=!1;break;case world.FlyingObject.VIEWPORT|world.FlyingObject.ENEMY:t.collisionGroup==world.FlyingObject.ENEMY?o.outOfView=!1:a.outOfView=!1;break;case world.FlyingObject.PLAYER|world.FlyingObject.POWERUPS:t.collisionGroup==world.FlyingObject.POWERUPS?(Global.playerShip.addBuff(o.buffType),o.dispose()):(Global.playerShip.addBuff(a.buffType),a.dispose())}},t.prototype.stopContact=function(e){var t=Global.world.endContactEvent.shapeA,i=Global.world.endContactEvent.shapeB,o=Global.world.endContactEvent.bodyA,a=Global.world.endContactEvent.bodyB;switch(t.collisionGroup|i.collisionGroup){case world.FlyingObject.VIEWPORT|world.FlyingObject.POWERUPS:t.collisionGroup==world.FlyingObject.POWERUPS?o.outOfView=!0:a.outOfView=!0;break;case world.FlyingObject.VIEWPORT|world.FlyingObject.ENEMY:t.collisionGroup==world.FlyingObject.ENEMY?o.outOfView=!0:a.outOfView=!0}},t.prototype.impact=function(e){var t=Global.world.impactEvent.shapeA,i=Global.world.impactEvent.shapeB,o=Global.world.impactEvent.bodyA,a=Global.world.impactEvent.bodyB;switch(t.collisionGroup|i.collisionGroup){case world.FlyingObject.P_BULLET|world.FlyingObject.ENEMY:t.collisionGroup==world.FlyingObject.P_BULLET?(o.dispose(),a.getHit(o.damage)):(a.dispose(),o.getHit(a.damage));break;case world.FlyingObject.E_BULLET|world.FlyingObject.PLAYER:t.collisionGroup==world.FlyingObject.E_BULLET?(o.dispose(),a.getHit(o.damage)):(a.dispose(),o.getHit(a.damage));break;case world.FlyingObject.PLAYER|world.FlyingObject.POWERUPS:t.collisionGroup==world.FlyingObject.POWERUPS?(Global.playerShip.addBuff(o.buffType),o.dispose()):(Global.playerShip.addBuff(a.buffType),a.dispose())}},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,o){function a(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Utils=function(){function e(){}return e.getDist=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},e}();__reflect(Utils.prototype,"Utils");var game;!function(e){var t=function(e){function t(t){void 0===t&&(t=null);var i=e.call(this,t)||this;return i.damage=1,i._lifespan=0,i}return __extends(t,e),Object.defineProperty(t.prototype,"lifeSpan",{set:function(e){var t=this;0!=e&&(this._lifespan=setTimeout(function(){t.dispose()},e))},enumerable:!0,configurable:!0}),t.prototype.setStyle=function(e,t){void 0===t&&(t=null),this.mc=new ui.SPMovieClip(e,t),this.displays=[this.mc],this.mc.playByLabel("normal",!0),this.displays=[this.mc]},t.prototype.disposeDone=function(){},t.prototype.dispose=function(){var t=this;clearTimeout(this._lifespan),e.prototype.dispose.call(this),this.displays[0].parent.setChildIndex(this.displays[0],this.displays[0].parent.numChildren),this.mc.playByLabel("dispose",!1),this.mc.once(egret.Event.COMPLETE,function(){t.displays[0].parent&&t.displays[0].parent.removeChild(t.displays[0]),delete t.mc},this),Global.world.removeBody(this)},t.prototype.render=function(){e.prototype.render.call(this)},t}(world.FlyingObject);e.Bullet=t,__reflect(t.prototype,"game.Bullet")}(game||(game={}));var game;!function(e){var t=function(t){function i(e){void 0===e&&(e=null);var i=t.call(this,e)||this;return i.health=5,i.speedMax=2,i.attackRate=10,i.behavior=[],i.orbitRadius=200,i.outOfView=!1,i.mc=Global.getMovieClipByName("enemy_1_png","enemy_1_json"),i.mc.gotoAndStop(1),i.displays=[i.mc],i.addShape(new p2.Circle({radius:20*world.FlyingObject.factor})),i.shapes[0].collisionGroup=world.FlyingObject.ENEMY,i.shapes[0].collisionMask=world.FlyingObject.VIEWPORT|world.FlyingObject.ENEMY|world.FlyingObject.PLAYER|world.FlyingObject.P_BULLET|world.FlyingObject.POWERUPS|world.FlyingObject.BORDER,i}return __extends(i,t),Object.defineProperty(i.prototype,"style",{set:function(e){},enumerable:!0,configurable:!0}),i.prototype.getHit=function(){this.health--,this.health<=0&&this.dispose()},i.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),Global.gameView.radar.clear(this),this.displays[0].parent.setChildIndex(this.displays[0],this.displays[0].parent.numChildren),this.mc.gotoAndPlay("dispose",1),this.mc.once(egret.Event.COMPLETE,function(){e.displays[0].parent.removeChild(e.displays[0])},this);var i=new particle.GravityParticleSystem(RES.getRes("ash_png"),RES.getRes("ash_json"));this.displays[0].parent.addChildAt(i,0),i.start(200),i.x=this.x,i.y=this.y,i.addEventListener(egret.Event.COMPLETE,function(){i.parent.removeChild(i)},this),Global.world.removeBody(this)},i.prototype.generateBullet=function(){var t=new e.Bullet({mass:.01});t.addShape(new p2.Circle({radius:500})),t.velocity=[20*Math.cos(this.angle),20*Math.sin(this.angle)],t.damping=0,t.shapes[0].collisionGroup=world.FlyingObject.E_BULLET,t.shapes[0].collisionMask=world.FlyingObject.PLAYER|world.FlyingObject.BORDER,t.setStyle("e_bullet_0_png","e_bullet_0_json"),t.lifeSpan=5e3,t.x=this.x+20*Math.cos(this.angle),t.y=this.y+20*Math.sin(this.angle),t.angle=this.angle,Global.gameView.addFob(t),Global.world.addBody(t)},i.prototype.render=function(){t.prototype.render.call(this),this.distanceToPlayer=Utils.getDist(new egret.Point(this.x,this.y),new egret.Point(Global.playerShip.x,Global.playerShip.y));var e=2*Math.round(this.orbitRadius%1)-1;if(-1!=this.behavior.indexOf(i.LOOKAT)&&(this.angle=Math.atan2(Global.playerShip.y-this.y,Global.playerShip.x-this.x)),-1!=this.behavior.indexOf(i.FOLLOW)){var o;o=Math.atan2(Global.playerShip.y-this.y,Global.playerShip.x-this.x),this.distanceToPlayer<this.orbitRadius&&-1!=this.behavior.indexOf(i.ORBIT)&&(o=Math.atan2(Global.playerShip.y-this.y,Global.playerShip.x-this.x)+Math.PI/2*e),this.speedx=this.speedMax*Math.cos(o),this.speedy=this.speedMax*Math.sin(o),this.x+=this.speedx,this.y+=this.speedy}this.selfTime/60%Math.round(10*Math.random())==0&&this.generateBullet(),this.outOfView?Global.gameView.radar.drawEnemy(this):Global.gameView.radar.clear(this)},i.FOLLOW="follow",i.ORBIT="orbit",i.LOOKAT="lookat",i}(e.Ship);e.EnemyShip=t,__reflect(t.prototype,"game.EnemyShip")}(game||(game={}));var game;!function(e){var t=function(e){function t(t,i){void 0===t&&(t=4096),void 0===i&&(i=4096);var o=e.call(this)||this;o.container=new egret.Sprite,o.prevX=0,o.prevY=0,o.bgDepth=.1,o._worldWidth=0,o._worldHeight=0,o._worldWidth=t,o._worldHeight=i,o.background=new ui.Background,o.radar=new ui.RadarSystem,o.addChild(o.background),o.addChild(o.container),o.addChild(o.radar),o.container.x=.5*Global.stage.stageWidth-.5*o.worldWidth,o.container.y=.5*Global.stage.stageHeight-.5*o.worldHeight,o.background.x=.5*Global.stage.stageWidth,.5*-o.worldWidth,o.background.y=.5*Global.stage.stageHeight,.5*-o.worldHeight,o.once(egret.Event.ADDED_TO_STAGE,o.ats,o);var a=world.FlyingObject.BORDER,r=world.FlyingObject.ENEMY|world.FlyingObject.PLAYER|world.FlyingObject.POWERUPS,l=p2.Body.STATIC,s=new p2.Body({mass:10});s.fixedX=!0,s.fixedY=!0,s.fixedRotation=!0,s.addShape(new p2.Box({width:t*world.FlyingObject.factor,height:100*world.FlyingObject.factor})),s.shapes[0].collisionGroup=a,s.shapes[0].collisionMask=r,s.displays=[],s.type=l,Global.world.addBody(s),s.position=[.5*t*world.FlyingObject.factor,0-50*world.FlyingObject.factor];var n=new p2.Body({mass:10});n.fixedX=!0,n.fixedY=!0,n.fixedRotation=!0,n.addShape(new p2.Box({width:t*world.FlyingObject.factor,height:100*world.FlyingObject.factor})),n.shapes[0].collisionGroup=a,n.shapes[0].collisionMask=r,n.displays=[],Global.world.addBody(n),n.type=l,n.position=[.5*t*world.FlyingObject.factor,(i+50)*world.FlyingObject.factor];var h=new p2.Body({mass:10});h.fixedX=!0,h.fixedY=!0,h.fixedRotation=!0,h.addShape(new p2.Box({width:100*world.FlyingObject.factor,height:i*world.FlyingObject.factor})),h.shapes[0].collisionGroup=a,h.shapes[0].collisionMask=r,h.displays=[],Global.world.addBody(h),h.type=l,h.position=[(t+50)*world.FlyingObject.factor,.5*i*world.FlyingObject.factor];var d=new p2.Body({mass:10});return d.fixedX=!0,d.fixedY=!0,d.fixedRotation=!0,d.addShape(new p2.Box({width:100*world.FlyingObject.factor,height:i*world.FlyingObject.factor})),d.shapes[0].collisionGroup=a,d.shapes[0].collisionMask=r,d.displays=[],Global.world.addBody(d),d.type=l,d.position=[0-50*world.FlyingObject.factor,.5*i*world.FlyingObject.factor],o}return __extends(t,e),t.prototype.ats=function(){this.background.generate()},Object.defineProperty(t.prototype,"worldWidth",{get:function(){return this._worldWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldHeight",{get:function(){return this._worldHeight},enumerable:!0,configurable:!0}),t.prototype.addFob=function(e){for(var t=0;t<e.displays.length;t++)this.container.addChild(e.displays[t])},t.prototype.render=function(){this.container.x=.5*Global.stage.stageWidth-Global.playerShip.x,this.container.y=.5*Global.stage.stageHeight-Global.playerShip.y,this.background.render(),this.prevX=this.container.x,this.prevY=this.container.y},t}(egret.Sprite);e.GameView=t,__reflect(t.prototype,"game.GameView")}(game||(game={}));var Global=function(){function e(){}return e.getBitmapByName=function(e){var t=new egret.Bitmap;return t.texture=RES.getRes(e),t},e.getMovieClipByName=function(e,t){var i=new egret.MovieClip(new egret.MovieClipDataFactory(RES.getRes(t),RES.getRes(e)).generateMovieClipData());return i},e.getParticleByName=function(e,t){var i=new particle.GravityParticleSystem(RES.getRes(e),RES.getRes(t));return i},e}();__reflect(Global.prototype,"Global");var game;!function(e){var t=function(e){function t(t,i,o){var a=e.call(this,t)||this;return a.health=1,a.buffType="",a.outOfView=!0,a.buffType=i,a.existTimer=60*o,a.addShape(new p2.Circle({radius:1750})),a.shapes[0].collisionGroup=world.FlyingObject.POWERUPS,a.shapes[0].collisionMask=world.FlyingObject.PLAYER|world.FlyingObject.ENEMY|world.FlyingObject.BORDER|world.FlyingObject.POWERUPS|world.FlyingObject.VIEWPORT,a.fixedRotation=!0,a.mc=new ui.SPMovieClip("powerups_png","powerups_json"),a.mc.playByLabel(i),a.displays=[a.mc],a}return __extends(t,e),t.prototype.getHit=function(){this.health--,this.health<=0&&this.dispose(!1)},t.prototype.dispose=function(t){var i=this;void 0===t&&(t=!0),Global.gameView.radar.clear(this),e.prototype.dispose.call(this),Global.world.removeBody(this),egret.Tween.get(this.displays[0]).to({scaleX:1.2,scaleY:1.2,alpha:0},250,egret.Ease.cubicOut).call(function(){i.displays[0].parent.removeChild(i.displays[0])})},t.prototype.render=function(){return e.prototype.render.call(this),this.selfTime>this.existTimer?void this.dispose(!0):void(this.outOfView?Global.gameView.radar.drawPowerUps(this):Global.gameView.radar.clear(this))},t.HOMING_MISSLE="weapon_missle",t.BEAM="weapon_beam",t.DAMAGE_UP="damageUp",t.SHIELD_UP="shieldUp",t.SPEED_UP="speedUp",t.MULTIPLIERx2="muiltiplierx2",t.TYPES={weapon_missle:600,weapon_beam:600,damageUp:900,shieldUp:600,speedUp:600,muiltiplierx2:1200},t}(world.FlyingObject);e.PowerUps=t,__reflect(t.prototype,"game.PowerUps")}(game||(game={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function o(o){t.call(i,o,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?o(a):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ui;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerNum=3,t.depth=[],t}return __extends(t,e),t.prototype.generate=function(){for(var e=0;e<this.layerNum;e++){var t=Global.getBitmapByName("star"+(e+1)+"_png");t.fillMode=egret.BitmapFillMode.REPEAT,t.width=(.5+.2*e)*(Global.gameView.worldWidth+2*Global.stage.stageWidth),t.height=(.5+.2*e)*(Global.gameView.worldHeight+2*Global.stage.stageHeight),this.depth.push(t),this.addChild(this.depth[e])}this.gridFrame=Global.getBitmapByName("gridframe_png"),this.grid=Global.getBitmapByName("grid_png"),this.grid.fillMode=egret.BitmapFillMode.REPEAT,this.addChild(this.grid),this.addChild(this.gridFrame),this.gridFrame.width=this.grid.width=Global.gameView.worldWidth,this.gridFrame.height=this.grid.height=Global.gameView.worldHeight},t.prototype.render=function(){this.gridFrame.x=this.grid.x=0-Global.playerShip.x,this.gridFrame.y=this.grid.y=0-Global.playerShip.y;for(var e=0;e<this.depth.length;e++)this.depth[e].x=.5*Global.gameView.worldWidth-.5*this.depth[e].width-Global.playerShip.x*(.5+.2*e),this.depth[e].y=.5*Global.gameView.worldHeight-.5*this.depth[e].height-Global.playerShip.y*(.5+.2*e)},t}(egret.Sprite);e.Background=t,__reflect(t.prototype,"ui.Background")}(ui||(ui={}));var ui;!function(e){var t=function(t){function i(){var i=t.call(this)||this;i.buffs={},i.buffCon=new egret.Sprite,i.bar=new egret.Sprite,i.bar.graphics.beginFill(16777215,1),i.bar.graphics.drawRect(0,0,500,2),i.bar.graphics.drawRect(0,-4,4,4),i.bar.graphics.drawRect(496,-4,4,4),i.bar.graphics.endFill(),i.addChild(i.bar),i.addChild(i.buffCon);for(var o in game.PowerUps.TYPES){var a=new egret.Sprite;i.buffs[o]=a,a.graphics.beginFill(16777215),a.graphics.moveTo(-6,17),a.graphics.lineTo(6,17),a.graphics.lineTo(0,7),a.graphics.lineTo(-6,17);var r=new e.SPMovieClip("powerups_png","powerups_json");r.playByLabel(o),r.scaleX=r.scaleY=.6,a.addChild(r),r.y=-30,a.visible=!1,i.buffCon.addChild(a)}return i.bar.x=i.buffCon.x=-250,i.bottom=80,i.horizontalCenter=0,i}return __extends(i,t),i.prototype.render=function(){this.alpha-=.05;for(var e in Global.playerShip.buffs)0!=Global.playerShip.buffs[e]?(this.alpha=1,this.buffs[e].visible=!0,this.buffs[e].x=Global.playerShip.buffs[e]/game.PowerUps.TYPES[e]*500):this.buffs[e].visible=!1;for(var t=0;t<this.buffCon.numChildren-1;t++)this.buffCon.getChildAt(t).x<this.buffCon.getChildAt(t+1).x&&this.buffCon.swapChildren(this.buffCon.getChildAt(t),this.buffCon.getChildAt(t+1))},i}(eui.Component);e.BuffBar=t,__reflect(t.prototype,"ui.BuffBar")}(ui||(ui={}));var ui;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.pool=[],t.arrows=[],t}return __extends(t,e),t.prototype.drawEnemy=function(e){if(-1==this.pool.indexOf(e)){this.pool.push(e);var t=Global.getBitmapByName("radar_r_png");t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height,this.addChild(t),t.x=.5*Global.stage.stageWidth,t.y=.5*Global.stage.stageHeight,this.arrows.push(t)}this.arrows[this.pool.indexOf(e)].rotation=180*Math.atan2(e.y-Global.playerShip.y,e.x-Global.playerShip.x)/Math.PI},t.prototype.drawPowerUps=function(e){if(-1==this.pool.indexOf(e)){this.pool.push(e);var t=Global.getBitmapByName("radar_w_png");t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height,this.addChild(t),t.x=.5*Global.stage.stageWidth,t.y=.5*Global.stage.stageHeight,this.arrows.push(t)}this.arrows[this.pool.indexOf(e)].rotation=180*Math.atan2(e.y-Global.playerShip.y,e.x-Global.playerShip.x)/Math.PI},t.prototype.clear=function(e){if(-1!=this.pool.indexOf(e)){var t=this.pool.indexOf(e);this.pool.splice(t,1),this.removeChild(this.arrows[t]),this.arrows.splice(t,1)}},t}(egret.Sprite);e.RadarSystem=t,__reflect(t.prototype,"ui.RadarSystem")}(ui||(ui={}));var ui;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e._isMoveDown=!1,e._isFireDown=!1,e._isShieldDown=!1,e.ctrlRad=60,e.skinName="resource/skins/ShipCTRL_Skin.exml",e}return __extends(i,t),i.prototype.childrenCreated=function(){this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.moveThumb.touchEnabled=!1,this.fireThumb.touchEnabled=!1,this.moveRing.touchEnabled=!0,this.fireRing.touchEnabled=!0,this.btShield.touchEnabled=!0,this.moveRing.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.fireRing.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.btShield.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.buffBar=new e.BuffBar,this.addChild(this.buffBar)},Object.defineProperty(i.prototype,"isMoveDown",{get:function(){return this._isMoveDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFireDown",{get:function(){return this._isFireDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isShieldDown",{get:function(){return this._isShieldDown},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"moveRad",{get:function(){return Math.atan2(this.moveThumb.y,this.moveThumb.x)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fireRad",{get:function(){return Math.atan2(this.fireThumb.y,this.fireThumb.x)},enumerable:!0,configurable:!0}),i.prototype.touchBegin=function(e){switch(e.target){case this.moveRing:this.moveId=e.touchPointID,this.setThumbPosition(e.touchPointID,e.stageX,e.stageY),this._isMoveDown=!0;break;case this.fireRing:this.fireId=e.touchPointID,this.setThumbPosition(e.touchPointID,e.stageX,e.stageY),this._isFireDown=!0;break;case this.btShield:this._isShieldDown=!0}this.setThumbPosition(e.touchPointID,e.stageX,e.stageY),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},i.prototype.touchMove=function(e){this.setThumbPosition(e.touchPointID,e.stageX,e.stageY)},i.prototype.touchEnd=function(e){switch(e.touchPointID){case this.moveId:this.moveId=-1,this._isMoveDown=!1,this.moveThumb.x=this.moveRing.x,this.moveThumb.y=this.moveRing.y;break;case this.fireId:this.fireId=-1,this._isFireDown=!1,this.fireThumb.x=this.fireRing.x,this.fireThumb.y=this.fireRing.y;break;default:this._isShieldDown=!1}},i.prototype.setThumbPosition=function(e,t,i){var o,a,r=new egret.Point;switch(e){case this.moveId:o=new egret.Point(t-this.moveKit.x,i-this.moveKit.y),Utils.getDist(r,o)>this.ctrlRad?(a=this.getNewPos(r,o),this.moveThumb.x=a.x,this.moveThumb.y=a.y):(this.moveThumb.x=o.x,this.moveThumb.y=o.y);break;case this.fireId:o=new egret.Point(t-this.fireKit.x,i-this.fireKit.y),Utils.getDist(r,o)>this.ctrlRad?(a=this.getNewPos(r,o),this.fireThumb.x=a.x,this.fireThumb.y=a.y):(this.fireThumb.x=o.x,this.fireThumb.y=o.y)}},i.prototype.getNewPos=function(e,t){var i=new egret.Point,o=Math.atan2(t.y-e.y,t.x-e.x);return i.x=e.x+Math.cos(o)*this.ctrlRad,i.y=e.y+Math.sin(o)*this.ctrlRad,i},i}(eui.Component);e.ShipController=t,__reflect(t.prototype,"ui.ShipController")}(ui||(ui={}));var ui;!function(e){var t=function(e){function t(t,i){var o=e.call(this,new egret.MovieClipDataFactory(RES.getRes(i),RES.getRes(t)).generateMovieClipData())||this;o.crtLabel="",o.crtStartFrame=0,o.crtEndFrame=0,o.endFrame=0,o.loop=!1,o.labelNames=[],o.sections=[];for(var a=0;a<o.frameLabels.length;a++)o.labelNames.push(o.frameLabels[a].name),o.sections[a]=new Object,o.sections[a].start=o.frameLabels[a].frame,a>=1&&(o.sections[a-1].end=o.frameLabels[a].frame-1),(o.frameLabels.length<=1||a==o.totalFrames-1)&&(o.sections[a].end=o.totalFrames);return o.once(egret.Event.REMOVED_FROM_STAGE,function(){o.removeEventListener(egret.Event.ENTER_FRAME,o.etf,o)},o),o}return __extends(t,e),t.prototype.playByLabel=function(e,t){void 0===t&&(t=!1),this.crtLabel=e,this.crtStartFrame=this.sections[this.labelNames.indexOf(e)].start,this.crtEndFrame=this.sections[this.labelNames.indexOf(e)].end,this.crtStartFrame==this.crtEndFrame?this.gotoAndStop(e):(this.gotoAndPlay(e),this.addEventListener(egret.Event.ENTER_FRAME,this.etf,this)),this.loop=t},t.prototype.etf=function(e){this.currentFrame>=this.crtEndFrame&&(this.loop?this.gotoAndPlay(this.crtStartFrame):(this.dispatchEvent(new egret.Event(egret.Event.COMPLETE,!0,!1)),this.stop()))},t}(egret.MovieClip);e.SPMovieClip=t,__reflect(t.prototype,"ui.SPMovieClip")}(ui||(ui={}));var game;!function(e){var t=function(t){function i(i){void 0===i&&(i=null);var o=t.call(this,i)||this;o.shield=0,o.shieldMax=60,o.shieldChargeTimer=0,o.damageMultiplyer=1,o.speedMax=5,o.attackRate=10,o.attackTime=0,o.buffs={};for(var a in e.PowerUps.TYPES)o.buffs[a]=0;return o.bodyCon=new egret.Sprite,o.shieldBar=new egret.Shape,o.shipmc=Global.getMovieClipByName("player_1_png","player_1_json"),o.shieldmc=Global.getMovieClipByName("shield_png","shield_json"),o.bodyCon.addChild(o.shipmc),o.bodyCon.addChild(o.shieldmc),o.shieldmc.play(-1),o.shieldmc.visible=!1,o.shieldBar.rotation=-90,o.displays=[o.bodyCon,o.shieldBar],o.addShape(new p2.Circle({radius:1250})),o.shapes[0].collisionGroup=world.FlyingObject.PLAYER,o.shapes[0].collisionMask=world.FlyingObject.ENEMY|world.FlyingObject.E_BULLET|world.FlyingObject.BORDER|world.FlyingObject.POWERUPS,o.addShape(new p2.Box({width:Global.stage.stageWidth*world.FlyingObject.factor,height:Global.stage.stageHeight*world.FlyingObject.factor})),o.shapes[1].collisionResponse=!1,o.shapes[1].collisionGroup=world.FlyingObject.VIEWPORT,o.shapes[1].collisionMask=world.FlyingObject.ENEMY|world.FlyingObject.POWERUPS,o.shield=o.shieldMax,o.shieldBar.alpha=0,o}return __extends(i,t),i.prototype.fire=function(){this.hasBuff(e.PowerUps.SPEED_UP)?this.speedMax=8:this.speedMax=4},i.prototype.stopFire=function(){this.hasBuff(e.PowerUps.SPEED_UP)?this.speedMax=8:this.speedMax=5},i.prototype.getHit=function(){this.shieldOn||this.dispose()},i.prototype.openShield=function(){this.shield--,this.shieldBar.alpha=1,this.shieldOn=!0,this.shield<=0&&(this.shield=0,this.shieldOn=!1),this.shieldChargeTimer=0},i.prototype.closeShield=function(){this.shieldOn=!1},i.prototype.render=function(){t.prototype.render.call(this),this.shieldmc.visible=this.shieldOn,this.shapes[0].radius=this.shieldOn?2500:1250,this.shapes[0].updateArea(),this.shapes[1].angle=-this.angle,this.shieldChargeTimer++,this.drawShieldBar(),this.shield<.5*this.shieldMax||this.shieldOn?this.shieldBar.alpha=1:this.shieldChargeTimer>=60&&(this.shieldBar.alpha*=.95),this.shieldChargeTimer>=60&&this.shield<=this.shieldMax&&this.shield++;for(var e in this.buffs)this.buffs[e]>0&&this.buffs[e]--},i.prototype.drawShieldBar=function(){this.shieldBar.graphics.clear(),0==this.shield?this.shieldBar.graphics.lineStyle(2,13369344,Math.abs(Math.cos(this.selfTime*Math.PI/22.5))):this.shieldBar.graphics.lineStyle(2,6710886),this.shieldBar.graphics.drawCircle(0,0,32),this.shieldBar.graphics.lineStyle(2,52224,1,!1,"normal",egret.CapsStyle.SQUARE),this.shieldBar.graphics.drawArc(0,0,32,Math.PI,Math.PI*((this.shieldMax-this.shield)/this.shieldMax),!0),this.shieldBar.graphics.drawArc(0,0,32,Math.PI,Math.PI*(1+this.shield/this.shieldMax),!1)},i.prototype.generateBullet=function(){if(this.attackTime++,this.attackTime%(60/this.attackRate)==0){var t=new e.Bullet({mass:.01});t.addShape(new p2.Circle({radius:500})),t.velocity=[50*Math.cos(this.angle),50*Math.sin(this.angle)],t.damping=0,t.shapes[0].collisionGroup=world.FlyingObject.P_BULLET,t.shapes[0].collisionMask=world.FlyingObject.ENEMY|world.FlyingObject.BORDER,t.setStyle("bullet_0_png","bullet_0_json"),t.lifeSpan=2e3,t.x=this.x+20*Math.cos(this.angle),t.y=this.y+20*Math.sin(this.angle),t.angle=this.angle,Global.gameView.addFob(t),Global.world.addBody(t)}},i.prototype.dispose=function(){t.prototype.dispose.call(this)},i.prototype.hasBuff=function(e){return!(0==this.buffs[e])},i.prototype.addBuff=function(t){this.buffs[t]=e.PowerUps.TYPES[t]},i}(e.Ship);e.PlayerShip=t,__reflect(t.prototype,"game.PlayerShip")}(game||(game={}));